<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title></title>
	<link rel="stylesheet" href="./style.css" media="screen" charset="utf-8">
</head>

<body>
	<div class="MEPthumb" vid="vid.mp4" pic="vid.jpg"></div>
	<div class="MEPthumb" vid="vid.mp4" pic="vid.jpg"></div>
	<div class="MEPthumb" vid="vid.mp4" pic="vid.jpg"></div>
	<div class="MEPthumb" vid="vid.mp4" pic="vid.jpg"></div>
	<div class="MEPthumb" vid="vid.mp4" pic="vid.jpg"></div>
	<!-- <iframe id="vid" src="./player?src=vid.mp4" frameborder="0"></iframe> -->
	<script src="jquery-3.2.1.min.js" charset="utf-8"></script>
	<script type="text/javascript" charset="utf-8">
		var MEPthumbs = {
			var: {
				thumbs: null,
				requestedVid: null,
				frame: null
			},
			con: function(a) {
				var b = 0,
					c = 0,
					d = !1,
					e = function e() {
						b++, a.funcs[b] ? (c++, a.funcs[b](function() {
							c--, e(b)
						})) : !c && !d && (a.done(), d = !0)
					};
				for (b = -1, i = 0; i < a.funcs.length && (e(i), i + 1 != a.size); i++);
			},
			injectImgs: function(cb) {
				var that = this;
				for (i = 0; i < this.var.thumbs.length; i++) {
					console.log('url("' + that.var.thumbs[i].getAttribute('pic') + '")');
					that.var.thumbs[i].style.backgroundImage = 'url("' + that.var.thumbs[i].getAttribute('pic') + '")'
				}
				cb();
			},
			ifrizzle: {
				file: null,
				vid: null,
				idc: -1,
				id: function() {
					this.idc++;
					if(this.idc > 4) this.idc = 0;
					return this.idc;
				},
				fillScreen: function (arg){

					// this.vid.style.width = '100%';
					// this.vid.style.height = '100%';
					// this.vid.style.float = 'none';
					// this.vid.style.position = 'fixed';
					// this.vid.style.padding = '0';
				},
				sendFile: function(el) {
					// iframe = document.getElementById('vid'+this.idc);
					// iframe.contentWindow.postMessage('comm-vid-file-'+this.file, 'http://' + window.location.host);
				},
				inject: function(el, cb) {
					// el.innerHTML = '<iframe id="vid' + this.id() + '" src="./player" frameborder="0"></iframe>';
					// cb();
				}
			},
			bindButtons: function(cb) {
				var that = this;
				that.var.thumbs.on('click', function(){
					that.ifrizzle.vid = this;
					that.unbindButtons();
					var el = this;
					that.ifrizzle.inject(this, function (){
						that.ifrizzle.file = el.getAttribute('vid');
					});
				});
				cb();
			},
			unbindButtons: function(cb) {
				var that = this;
				that.var.thumbs.off('click');
				// cb();
			},
			init: function(arg) {
				var that = this;
				var data;
				var arr;
				$(window).on('message', function(e) {
					data = e.originalEvent.data;
					arr = data.split('comm-vid-');
					if(arr.length - 1) {
						arr = arr[1].split('-');
						switch (arr[0]) {
							case 'init':
								that.ifrizzle.sendFile();
								// iframe = document.getElementById('vid');
								// iframe.contentWindow.postMessage('shizzle', 'http://' + window.location.host);
								break;
							case 'show':
								that.ifrizzle.fillScreen();
								// iframe = document.getElementById('vid');
								// iframe.contentWindow.postMessage('shizzle', 'http://' + window.location.host);
								break;
							default:

						}
					}
					// that.ifrizzle.show();
					// iframe = document.getElementById('vid');
					// iframe.contentWindow.postMessage('shizzle', 'http://' + window.location.host);
				});
				this.var.thumbs = $('.MEPthumb');
				that.con({
					size: 100,
					funcs: [
						function(complete) {
							that.injectImgs(complete);

						},
						function(complete) {
							that.bindButtons(complete);
						}
					],
					done: function(arg) {
						console.log('done woo');

					}
				});

			}
		};
		MEPthumbs.init();
	</script>
	<!-- <script src="______" type="text/javascript" charset="utf-8"></script> -->
</body>

</html>
